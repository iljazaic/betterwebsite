<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Ilja Zaicevs</title>
    <link rel="stylesheet" href="../css/styles.css?v=2.2">
    <link rel="stylesheet" href="../css/mobile_design.css?v=1.1.3">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />



    <meta name="viewport"
        content="width=device-width,height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
</head>

<body style="background-color: rgb(0, 0, 0); color: white;">
    <div class="title">
        <h1 id="title">
            --title--
        </h1>
        <a style="width: 50px; left: calc( 50% - 26px ); position: relative;" href="/">Back</a>
        <a style="width: 50px; left: calc( 50% - 97px ); top: 35px; position: relative; padding-bottom: 20px;"
            id="gh">GitHub</a>

    </div>
    <div class="mainDiv" style="background-color: black;">

    </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-clike.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>


<script>


    function zoom(el) {
        console.log(el.style.transform)
        if (el.style.transform !== "scale(2)") {
            el.style.transform = "scale(2)";
            el.style.zIndex = "100"
        } else {
            el.style.transform = "scale(1)";
        }
    }


    async function loadProject() {
        const pathParts = window.location.pathname.split('/');
        const projectName = pathParts[pathParts.length - 1].replace('.html', '');
        try {
            const response = await fetch('/resources/projects.json');
            const projects = await response.json();
            const project = projects.find(p => p.projectName === projectName);

            if (!project) {
                document.querySelector('.mainDiv').innerHTML = '<p>Project not found</p>';
                return;
            }

            document.querySelector("#title").innerText = project.officialName;
            document.querySelector("#gh").setAttribute("href", project.github);

            let html = '';
            let c = '';
            project.structure.forEach(item => {
                c = item.classes != undefined ? item.classes : '';
                if (item.tag === 'pre') {
                    html += `<pre><code class="language-${item.lang}">${escapeHtml(item.content)}</code></pre>`;
                    if (item.sub) html += `<p class="figure-sub">${escapeHtml(item.sub)}</p>`;
                } else if (item.tag === 'img') {
                    html += `<img onclick="zoom(this)" src="${item.src}" alt="${item.alt}">`;
                    if (item.sub) html += `<p class="figure-sub">${escapeHtml(item.sub)}</p>`;
                } else if (item.tag === 'code') {
                    html += `<code class="language-${item.lang}">${escapeHtml(item.content)}</code>`;
                    if (item.sub) html += `<p class="figure-sub">${escapeHtml(item.sub)}</p>`;
                } else if (item.tag === 'a') {
                    html += `<div class="lnk" style="display:flex;flex-direction:row; "><span>${escapeHtml(item.label)} </span><a href="${item.href}"> ${item.href}</a></div>`;
                }
                else {
                    html += `<${item.tag} class="${c}">${escapeHtml(item.content)}</${item.tag}>`;
                }
            });

            document.querySelector('.mainDiv').innerHTML = html;

            // Call Prism AFTER content is inserted
            Prism.highlightAll();

        } catch (error) {
            console.error('Error loading project:', error);
            document.querySelector('.mainDiv').innerHTML = '<p>Error loading project</p>';
        }
    }

    function escapeHtml(text) {
        const map = {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#039;'
        };
        return text.replace(/[&<>"']/g, m => map[m]);
    }

    // Load project when page loads
    document.addEventListener('DOMContentLoaded', loadProject);
</script>

</html>